<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gamification External Metric Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root{
      --primary-color:#63AB8F; --secondary-color:#4A8C7D; --border-color:#DEE2E6;
      --light-bg:#F8F9FA; --card-bg:#FFFFFF; --text-color:#2C3E50; --text-light:#6C757D;
      --pill:#e9f6f0;
    }
    body{
      font-family:'Aptos','Segoe UI',system-ui,-apple-system,Arial,sans-serif;
      margin:20px;padding:20px;max-width:1200px;background:var(--light-bg);color:var(--text-color)
    }
    #logo-container{text-align:center;margin-bottom:20px} #logo{width:300px}
    h1{margin:0 0 16px}
    .card{background:var(--card-bg);border:1px solid var(--border-color);border-radius:12px;padding:24px;margin-top:16px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
    label{display:block;font-weight:600;margin-bottom:6px}
    input,select,button,textarea{padding:10px;border:1px solid var(--border-color);border-radius:6px;background:#fff;font-size:14px}
    button{background:var(--primary-color);color:#fff;font-weight:600;cursor:pointer;transition:background .2s}
    button:hover{background:var(--secondary-color)} button:disabled{background:var(--text-light);cursor:not-allowed}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;align-items:end}
    .full-width-btn{width:100%;padding:14px 18px;font-size:16px;margin-top:12px}
    .muted{color:var(--text-light);font-size:12px}
    .section-title{margin:0 0 10px;color:var(--secondary-color)}
    #messageContainer{display:none;margin-top:12px}
    .error-message{color:#b4231a;background:#fee2e2;border:1px solid #fecaca;padding:10px;border-radius:6px}
    .success-message{color:#14532d;background:#dcfce7;border:1px solid #bbf7d0;padding:10px;border-radius:6px}
    .info-message{color:#6b4e16;background:#fff7ed;border:1px solid #ffedd5;padding:10px;border-radius:6px}
    .file-upload-area{
      border:2px dashed var(--border-color);
      border-radius:8px;
      padding:40px 20px;
      text-align:center;
      background:var(--light-bg);
      cursor:pointer;
      transition:border-color .2s, background .2s;
    }
    .file-upload-area:hover{
      border-color:var(--primary-color);
      background:#f0f7f4;
    }
    .file-upload-area.has-file{
      border-color:var(--primary-color);
      background:#e9f6f0;
    }
    .upload-icon{
      font-size:48px;
      color:var(--primary-color);
      margin-bottom:12px;
    }
    .file-name{
      margin-top:12px;
      font-weight:600;
      color:var(--primary-color);
    }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
    }
    th, td{
      border:1px solid var(--border-color);
      padding:10px;
      text-align:left;
    }
    th{
      background:var(--light-bg);
      font-weight:600;
    }
    tr:nth-child(even){
      background:#fafafa;
    }
    .preview-container{
      max-height:400px;
      overflow:auto;
      margin-top:16px;
    }
    .json-preview{
      background:#f8f9fa;
      border:1px solid var(--border-color);
      border-radius:6px;
      padding:16px;
      font-family:monospace;
      font-size:12px;
      white-space:pre-wrap;
      max-height:400px;
      overflow:auto;
    }
    .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s ease-inout infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading { display: flex; align-items: center; gap: 8px; }
    .help-text { background: #f8f9fa; border-left: 3px solid var(--primary-color); padding: 12px; margin: 12px 0; font-size: 14px; }
    .help-text ul { margin: 8px 0; padding-left: 20px; }
    .help-text li { margin-bottom: 4px; }
    .date-format-info { background: #e9f6f0; border: 1px solid var(--primary-color); border-radius: 6px; padding: 12px; margin: 12px 0; font-size: 14px; }
    .example-csv-section { background: #e9f6f0; border: 1px solid var(--primary-color); border-radius: 6px; padding: 16px; margin: 16px 0; }
    .example-csv-section h3 { margin-top: 0; color: var(--secondary-color); }
    .example-csv-section code { background: #fff; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 12px; border: 1px solid var(--border-color); }
    .example-csv-table { width: 100%; margin: 12px 0; font-size: 12px; }
    .example-csv-table th, .example-csv-table td { padding: 6px; border: 1px solid #ccc; text-align: left; }
    .example-csv-table th { background: #f0f7f4; }
    .btn-secondary { background: #6c757d; border-color: #6c757d; }
    .btn-secondary:hover { background: #5a6268; border-color: #545b62; }
    .action-buttons { display: flex; gap: 12px; margin-top: 12px; }
    .warning-note { background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 12px; margin: 12px 0; font-size: 14px; color: #856404; }
  </style>
</head>

<body>
  <div id="logo-container">
    <img id="logo" src="https://raw.githubusercontent.com/gmcglynn88/Management-Unit-Search/main/Consultinglogo%20(2).png" alt="Company Logo">
  </div>

  <h1>Gamification External Metric Upload</h1>

  <div id="appContent">
    <div id="messageContainer"></div>

    <!-- Example CSV Section -->
    <div class="card">
      <h2 class="section-title">Example CSV Format</h2>
      <div class="example-csv-section">
        <p>Download an example CSV file to ensure your data is in the correct format:</p>

        <table class="example-csv-table">
          <thead>
            <tr>
              <th>UserID</th>
              <th>UserEmail</th>
              <th>DateOccurred</th>
              <th>Value</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>08377fd8-3680-4a50-b909-c685e1567659</td>
              <td>john.doe@company.com</td>
              <td>03/12/2025</td>
              <td>95</td>
              <td>total</td>
            </tr>
            <tr>
              <td>1a2b3c4d-5678-90ef-ghij-klmnopqrstuv</td>
              <td>jane.smith@company.com</td>
              <td>2025-12-02</td>
              <td>42.5</td>
              <td>cumulative</td>
            </tr>
            <tr>
              <td></td>
              <td>mike.jones@company.com</td>
              <td>02/12/2025</td>
              <td>100</td>
              <td>total</td>
            </tr>
          </tbody>
        </table>

        <div class="action-buttons">
          <button id="downloadExampleBtn" class="btn-secondary">üì• Download Example CSV</button>
          <button id="copyExampleBtn" class="btn-secondary">üìã Copy CSV Format</button>
        </div>

        <div class="muted" style="margin-top: 12px;">
          Save your CSV in UTF-8 format for best compatibility
        </div>
      </div>
    </div>

    <!-- CSV Upload -->
    <div class="card">
      <h2 class="section-title">Upload CSV File</h2>
      <div class="date-format-info">
        <strong>CSV Format Requirements:</strong>
        <ul style="margin: 8px 0 0 0; padding-left: 20px;">
          <li>Your CSV should have 5 header columns: UserID, UserEmail, DateOccurred, Value, Type</li>
          <li>Date can be UK format (DD/MM/YYYY) or ISO format (YYYY-MM-DD)</li>
          <li>Either UserID OR Email Address required</li>
        </ul>
      </div>

      <div class="warning-note">
        <strong>‚ö†Ô∏è Important:</strong> Ensure your CSV has separate columns (not all data in one column).
      </div>

      <div id="fileUploadArea" class="file-upload-area">
        <div class="upload-icon">üìÅ</div>
        <div><strong>Click to upload CSV file</strong></div>
        <div class="muted" style="margin-top: 8px;">or drag and drop your file here</div>
      </div>
      <input type="file" id="fileInput" accept=".csv" style="display:none" />
      <div id="fileName" class="file-name"></div>
    </div>

    <div id="csvPreviewCard" class="card" style="display:none;">
      <h2 class="section-title">CSV Preview</h2>
      <div id="csvPreview" class="preview-container"></div>
      <button id="convertToJsonBtn" class="full-width-btn">Convert to JSON</button>
    </div>

    <div id="jsonPreviewCard" class="card" style="display:none;">
      <h2 class="section-title">JSON Preview</h2>
      <div id="jsonPreview" class="json-preview"></div>
      <button id="downloadJsonBtn" class="full-width-btn">Download JSON</button>
    </div>
  </div>

<script>
/* =========================================================================
   EXAMPLE CSV DATA
   ========================================================================= */
const exampleCSV = `UserID,UserEmail,DateOccurred,Value,Type
08377fd8-3680-4a50-b909-c685e1567659,john.doe@company.com,03/12/2025,95,total
1a2b3c4d-5678-90ef-ghij-klmnopqrstuv,jane.smith@company.com,2025-12-02,42.5,cumulative
;mike.jones@company.com;02/12/2025;100;total
abc12345-6789-1011-1213-141516171819;sarah.wilson@company.com;01/12/2025;75;total
;admin@company.com;2025-11-30;50.25;cumulative`;

let csvData = [];
let jsonData = null;

/* =========================================================================
   UTILITY FUNCTIONS
   ========================================================================= */
function showMessage(message, type = 'info') {
  const messageContainer = document.getElementById('messageContainer');
  if (!messageContainer) return;
  
  messageContainer.innerHTML = '';
  messageContainer.style.display = 'block';
  
  const messageDiv = document.createElement('div');
  messageDiv.className = `${type}-message`;
  messageDiv.innerHTML = message;
  messageContainer.appendChild(messageDiv);
  
  // Auto-hide success messages after 5 seconds
  if (type === 'success') {
    setTimeout(() => {
      messageContainer.style.display = 'none';
    }, 5000);
  }
}

function convertToISODate(dateStr) {
  if (!dateStr) return '';
  
  dateStr = dateStr.trim();
  
  // Check if it's already in ISO format (YYYY-MM-DD)
  const isoRegex = /^\d{4}-\d{2}-\d{2}$/;
  if (isoRegex.test(dateStr)) {
    return dateStr;
  }
  
  // Try UK format (DD/MM/YYYY or DD-MM-YYYY)
  const ukRegex = /^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/;
  const match = dateStr.match(ukRegex);
  if (match) {
    const day = match[1].padStart(2, '0');
    const month = match[2].padStart(2, '0');
    const year = match[3];
    return `${year}-${month}-${day}`;
  }
  
  return dateStr;
}

function validateISODate(dateStr) {
  if (!dateStr) return false;
  
  const isoRegex = /^\d{4}-\d{2}-\d{2}$/;
  if (!isoRegex.test(dateStr)) return false;
  
  const date = new Date(dateStr);
  return date instanceof Date && !isNaN(date);
}

/* =========================================================================
   DOWNLOAD AND COPY FUNCTIONS
   ========================================================================= */
function downloadExampleCSV() {
  try {
    const blob = new Blob([exampleCSV], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'gamification_example.csv';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    setTimeout(() => URL.revokeObjectURL(url), 100);
    
    showMessage('Example CSV file downloaded successfully!', 'success');
  } catch (error) {
    console.error('Error downloading CSV:', error);
    showMessage('Error downloading example CSV. Please try again.', 'error');
  }
}

function copyExampleFormat() {
  const textArea = document.createElement('textarea');
  textArea.value = exampleCSV;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  textArea.style.top = '-999999px';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    const successful = document.execCommand('copy');
    if (successful) {
      showMessage('CSV format copied to clipboard!', 'success');
    } else {
      throw new Error('Copy command failed');
    }
  } catch (err) {
    console.error('Failed to copy: ', err);
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(exampleCSV)
        .then(() => {
          showMessage('CSV format copied to clipboard!', 'success');
        })
        .catch(clipboardErr => {
          console.error('Clipboard API error: ', clipboardErr);
          showMessage('Failed to copy to clipboard. Please manually select and copy the example table.', 'error');
        });
    } else {
      showMessage('Failed to copy to clipboard. Please manually select and copy the example table.', 'error');
    }
  } finally {
    document.body.removeChild(textArea);
  }
}

function downloadJson() {
  if (!jsonData) {
    showMessage('No JSON data to download', 'error');
    return;
  }
  
  try {
    const jsonString = JSON.stringify(jsonData, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'gamification_data.json';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    setTimeout(() => URL.revokeObjectURL(url), 100);
    
    showMessage('JSON file downloaded successfully!', 'success');
  } catch (error) {
    console.error('Error downloading JSON:', error);
    showMessage('Error downloading JSON file. Please try again.', 'error');
  }
}

/* =========================================================================
   CSV PARSING FUNCTIONS
   ========================================================================= */
function parseCSV(csvText) {
  try {
    let text = csvText;
    
    // Remove BOM if present
    if (text.charCodeAt(0) === 0xFEFF || text.charCodeAt(0) === 0xFFFE) {
      text = text.substring(1);
    }
    
    // Replace different line endings with \n
    text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
    
    const lines = text.split('\n');
    if (lines.length === 0) {
      showMessage('CSV file is empty', 'error');
      return;
    }
    
    // Find first non-empty line for headers
    let headerLineIndex = 0;
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].trim().length > 0) {
        headerLineIndex = i;
        break;
      }
    }
    
    // Get headers
    const headerLine = lines[headerLineIndex];
    let headers = [];
    
    // Check delimiter
    if (headerLine.includes(';')) {
      headers = headerLine.split(';').map(h => h.trim());
    } else if (headerLine.includes('"')) {
      headers = headerLine.match(/(?:[^,"]+|"[^"]*")+/g) || [];
      headers = headers.map(h => h.replace(/^"|"$/g, '').trim());
    } else {
      headers = headerLine.split(',').map(h => h.trim());
    }
    
    headers = headers.filter(h => h.length > 0);
    
    // Parse data rows
    csvData = [];
    
    for (let i = headerLineIndex + 1; i < lines.length; i++) {
      const line = lines[i].trim();
      if (!line || line === '' || line.replace(/[;,]/g, '').trim().length === 0) {
        continue;
      }
      
      let values = [];
      
      // Check delimiter used in data row
      if (line.includes(';')) {
        values = line.split(';').map(v => v.trim());
      } else if (line.includes('"')) {
        values = line.match(/(?:[^,"]+|"[^"]*")+/g) || [];
        values = values.map(v => v.replace(/^"|"$/g, '').trim());
      } else {
        values = line.split(',').map(v => v.trim());
      }
      
      // Ensure we have enough values for all headers
      while (values.length < headers.length) {
        values.push('');
      }
      
      const row = {};
      let hasData = false;
      
      for (let j = 0; j < headers.length; j++) {
        const header = headers[j];
        const value = values[j] || '';
        row[header] = value;
        
        if (value && value.trim().length > 0) {
          hasData = true;
        }
      }
      
      if (hasData) {
        csvData.push(row);
      }
    }
    
    if (csvData.length === 0) {
      showMessage('No valid data found in CSV file. Please ensure your CSV has data rows.', 'error');
      return;
    }
    
    showCSVPreview(headers, csvData);
    
  } catch (error) {
    console.error('Error parsing CSV:', error);
    showMessage(`Error parsing CSV: ${error.message}. Please ensure your CSV is properly formatted.`, 'error');
  }
}

function showCSVPreview(headers, data) {
  const previewDiv = document.getElementById('csvPreview');
  if (!previewDiv) return;
  
  previewDiv.innerHTML = '';
  
  if (data.length === 0) {
    previewDiv.innerHTML = '<div class="muted">No data found in CSV file</div>';
    return;
  }
  
  const table = document.createElement('table');
  
  // Create header row
  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  headers.forEach(header => {
    const th = document.createElement('th');
    th.textContent = header;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);
  
  // Create body with first 10 rows
  const tbody = document.createElement('tbody');
  const displayRows = Math.min(data.length, 10);
  for (let i = 0; i < displayRows; i++) {
    const row = document.createElement('tr');
    headers.forEach(header => {
      const td = document.createElement('td');
      const value = data[i][header] || '';
      td.textContent = value.length > 50 ? value.substring(0, 50) + '...' : value;
      td.title = value;
      row.appendChild(td);
    });
    tbody.appendChild(row);
  }
  table.appendChild(tbody);
  
  previewDiv.appendChild(table);
  
  // Show total count
  const countDiv = document.createElement('div');
  countDiv.className = 'muted';
  countDiv.style.marginTop = '12px';
  countDiv.textContent = `Showing ${displayRows} of ${data.length} rows`;
  previewDiv.appendChild(countDiv);
  
  // Show CSV preview card
  document.getElementById('csvPreviewCard').style.display = 'block';
}

function convertToJson() {
  try {
    if (csvData.length === 0) {
      showMessage('No CSV data to convert', 'error');
      return;
    }
    
    const items = [];
    let validationErrors = [];
    
    csvData.forEach((row, index) => {
      try {
        // Normalize column names
        const normalizedRow = {};
        Object.keys(row).forEach(key => {
          normalizedRow[key.toLowerCase()] = row[key];
        });
        
        // Get values
        const userId = normalizedRow.userid || normalizedRow.user_id || '';
        const userEmail = normalizedRow.useremail || normalizedRow.user_email || normalizedRow.email || '';
        const dateOccurredRaw = normalizedRow.dateoccurred || normalizedRow.dateoccured || normalizedRow.date_occurred || normalizedRow.date || '';
        const value = normalizedRow.value || '0';
        const type = normalizedRow.type || '';
        
        // Validate required fields
        if (!userId && !userEmail) {
          throw new Error(`Row ${index + 2}: Either UserID or UserEmail is required`);
        }
        
        if (!dateOccurredRaw) {
          throw new Error(`Row ${index + 2}: DateOccurred is required`);
        }
        
        // Convert date format
        const dateOccurredISO = convertToISODate(dateOccurredRaw);
        if (!validateISODate(dateOccurredISO)) {
          throw new Error(`Row ${index + 2}: Invalid date format. Use DD/MM/YYYY or YYYY-MM-DD. Got: "${dateOccurredRaw}"`);
        }
        
        // Validate type field
        const normalizedType = type.toLowerCase().trim();
        if (!normalizedType) {
          throw new Error(`Row ${index + 2}: Type is required and must be "Total" or "Cumulative"`);
        }
        
        if (normalizedType !== 'total' && normalizedType !== 'cumulative') {
          throw new Error(`Row ${index + 2}: Type must be "Total" or "Cumulative" (got: "${type}")`);
        }
        
        // Parse numeric value
        const parsedValue = parseFloat(value);
        if (isNaN(parsedValue)) {
          throw new Error(`Row ${index + 2}: Value must be a number (got: "${value}")`);
        }
        
        // Create item
        const item = {
          type: type.charAt(0).toUpperCase() + type.slice(1).toLowerCase(),
          dateOccurred: dateOccurredISO,
          value: parsedValue
        };
        
        // Add userId OR userEmail
        if (userId) {
          item.userId = userId;
        } else if (userEmail) {
          item.userEmail = userEmail;
        }
        
        items.push(item);
        
      } catch (rowError) {
        validationErrors.push(rowError.message);
      }
    });
    
    if (validationErrors.length > 0) {
      throw new Error(`Validation errors:\n${validationErrors.join('\n')}`);
    }
    
    if (items.length === 0) {
      throw new Error('No valid data to convert');
    }
    
    jsonData = { items: items };
    
    // Update JSON preview
    updateJsonPreview();
    
    // Show JSON preview card
    document.getElementById('jsonPreviewCard').style.display = 'block';
    
    showMessage(`Successfully converted ${items.length} rows to JSON format`, 'success');
    
  } catch (error) {
    console.error('Error converting to JSON:', error);
    showMessage(`Error converting data: ${error.message}`, 'error');
  }
}

function updateJsonPreview() {
  if (!jsonData) return;
  
  const jsonPreview = document.getElementById('jsonPreview');
  if (!jsonPreview) return;
  
  // Create a copy to preview (limit to 5 items for preview)
  const previewData = {
    items: jsonData.items.slice(0, 5)
  };
  
  jsonPreview.textContent = JSON.stringify(previewData, null, 2);
  
  // Show total count
  const countInfo = document.createElement('div');
  countInfo.className = 'muted';
  countInfo.style.marginTop = '12px';
  countInfo.textContent = `Total items: ${jsonData.items.length}`;
  
  // Remove existing count info if present
  const existingCount = jsonPreview.parentNode.querySelector('.muted');
  if (existingCount) {
    existingCount.remove();
  }
  
  jsonPreview.parentNode.appendChild(countInfo);
}

/* =========================================================================
   FILE HANDLING FUNCTIONS
   ========================================================================= */
function handleFileSelect(e) {
  const file = e.target.files[0];
  handleFile(file);
}

function handleFile(file) {
  if (!file) return;
  
  if (!file.name.toLowerCase().endsWith('.csv')) {
    showMessage('Please select a CSV file', 'error');
    return;
  }
  
  // Update UI
  document.getElementById('fileName').textContent = `Selected: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
  document.getElementById('fileUploadArea').classList.add('has-file');
  
  // Read and parse CSV
  const reader = new FileReader();
  reader.onload = function(e) {
    const csvText = e.target.result;
    parseCSV(csvText);
  };
  reader.onerror = function() {
    showMessage('Error reading file', 'error');
  };
  reader.readAsText(file);
}

/* =========================================================================
   INITIALIZATION
   ========================================================================= */
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing...');
  
  // Add event listeners for buttons
  const downloadExampleBtn = document.getElementById('downloadExampleBtn');
  const copyExampleBtn = document.getElementById('copyExampleBtn');
  const convertToJsonBtn = document.getElementById('convertToJsonBtn');
  const downloadJsonBtn = document.getElementById('downloadJsonBtn');
  const fileUploadArea = document.getElementById('fileUploadArea');
  const fileInput = document.getElementById('fileInput');
  
  if (downloadExampleBtn) {
    downloadExampleBtn.addEventListener('click', downloadExampleCSV);
  }
  
  if (copyExampleBtn) {
    copyExampleBtn.addEventListener('click', copyExampleFormat);
  }
  
  if (convertToJsonBtn) {
    convertToJsonBtn.addEventListener('click', convertToJson);
  }
  
  if (downloadJsonBtn) {
    downloadJsonBtn.addEventListener('click', downloadJson);
  }
  
  if (fileUploadArea && fileInput) {
    fileUploadArea.addEventListener('click', () => {
      fileInput.click();
    });
    
    fileInput.addEventListener('change', handleFileSelect);
    
    // Drag and drop support
    fileUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadArea.style.borderColor = 'var(--primary-color)';
      fileUploadArea.style.background = '#f0f7f4';
    });
    
    fileUploadArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      fileUploadArea.style.borderColor = 'var(--border-color)';
      fileUploadArea.style.background = 'var(--light-bg)';
    });
    
    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
      fileUploadArea.style.borderColor = 'var(--border-color)';
      fileUploadArea.style.background = 'var(--light-bg)';
    });
  }
  
  console.log('Event listeners initialized');
});
</script>
</body>
</html>
